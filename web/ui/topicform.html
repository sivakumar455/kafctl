{{define "createTopicForm"}}

<body>
    {{ template "home-header"}}
    <div class="container" style="padding: 20px;">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-7">                
                <main>
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="bi bi-plus-circle me-2"></i>Create New Topic
                            </h4>
                        </div>
                        <div class="card-body p-4">
                            <div id="create-topic-result" class="mb-3"></div>
                            
                            <form id="create-topic-form" hx-post="/createtopic" hx-target="#create-topic-result" hx-swap="innerHTML">
                                <!-- Topic Name -->
                                <div class="mb-4">
                                    <label for="topicName" class="form-label fw-bold">
                                        Topic Name <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-lg" 
                                           id="topicName" 
                                           name="topicName" 
                                           placeholder="Enter topic name (e.g., user-events, orders, logs)"
                                           required
                                           pattern="[a-zA-Z0-9._-]+"
                                           title="Topic name can only contain letters, numbers, dots, underscores, and hyphens">
                                    <div class="form-text">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Topic names can contain letters, numbers, dots (.), underscores (_), and hyphens (-)
                                    </div>
                                </div>

                                <!-- Configuration Row -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <label for="numPartitions" class="form-label fw-bold">
                                            Number of Partitions <span class="text-danger">*</span>
                                        </label>
                                        <input type="number" 
                                               class="form-control" 
                                               id="numPartitions" 
                                               name="numPartitions" 
                                               value="1" 
                                               min="1" 
                                               max="10000"
                                               required>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            More partitions = higher parallelism. Recommended: 3-6 for most use cases.
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="numReplicas" class="form-label fw-bold">
                                            Replication Factor <span class="text-danger">*</span>
                                        </label>
                                        <input type="number" 
                                               class="form-control" 
                                               id="numReplicas" 
                                               name="numReplicas" 
                                               value="1" 
                                               min="1" 
                                               max="10"
                                               required>
                                        <div class="form-text">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Number of copies. Recommended: 3 for production (requires 3+ brokers).
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-flex gap-2 justify-content-end">
                                    <button type="button" 
                                            class="btn btn-outline-secondary" 
                                            onclick="resetForm()">
                                        <i class="bi bi-arrow-clockwise me-2"></i>Reset
                                    </button>
                                    <button type="submit" 
                                            class="btn btn-primary btn-lg">
                                        <i class="bi bi-check-circle me-2"></i>Create Topic
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Help Card -->
                    <div class="card border-info mb-4">
                        <div class="card-header bg-info bg-opacity-10">
                            <h6 class="mb-0">
                                <i class="bi bi-question-circle me-2"></i>Topic Creation Guidelines
                            </h6>
                        </div>
                        <div class="card-body">
                            <ul class="mb-0">
                                <li><strong>Partitions:</strong> Higher number allows more parallelism but also increases overhead. Start with 3-6 partitions.</li>
                                <li><strong>Replication:</strong> Ensures data durability. Use 3 replicas in production for fault tolerance.</li>
                                <li><strong>Topic Naming:</strong> Use descriptive, lowercase names with hyphens or underscores (e.g., <code>user-events</code>, <code>payment_orders</code>).</li>
                            </ul>
                        </div>
                    </div>
                </main>
        
                {{ template "kaf-footer"}}
            </div>
        </div>
    </div>
    <script src="/static/main.js?v=2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org@2.0.3"
        integrity="sha384-0895/pl2MU10Hqc6jd4RvrthNlDiE9U1tWmX7WRESftEDRosgxNsQG/Ze9YMRzHq"
        crossorigin="anonymous"></script>

    <script>
        // Reset form function
        function resetForm() {
            document.getElementById('create-topic-form').reset();
            document.getElementById('numPartitions').value = 1;
            document.getElementById('numReplicas').value = 1;
            document.getElementById('create-topic-result').innerHTML = '';
        }

        // Format and display alert after HTMX response
        document.body.addEventListener('htmx:afterSwap', function(event) {
            if (event.detail.target && event.detail.target.id === 'create-topic-result') {
                const resultDiv = event.detail.target;
                if (resultDiv && resultDiv.innerHTML.trim() !== '') {
                    let content = '';
                    if (resultDiv.firstChild) {
                        content = resultDiv.firstChild.textContent || resultDiv.firstChild.innerText || resultDiv.textContent || '';
                    } else {
                        content = resultDiv.textContent || resultDiv.innerText || '';
                    }
                    content = content.trim();
                    
                    // Check if it's a success or error message
                    if (content.includes('successfully') || content.includes('Success')) {
                        const topicName = extractTopicName(content);
                        resultDiv.innerHTML = `
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                <strong><i class="bi bi-check-circle-fill"></i> Success!</strong> Topic <strong>${escapeHtml(topicName)}</strong> created successfully!
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        `;
                        // Reset form on success
                        setTimeout(() => {
                            resetForm();
                        }, 2000);
                    } else if (content.includes('Error') || content.includes('error')) {
                        resultDiv.innerHTML = `
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                <strong><i class="bi bi-exclamation-triangle-fill"></i> Error!</strong> ${escapeHtml(content)}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        `;
                    }
                    
                    // Scroll to result
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        });
        
        // Helper function to extract topic name from success message
        function extractTopicName(message) {
            const match = message.match(/['"]([^'"]+)['"]/);
            return match ? match[1] : 'topic';
        }
        
        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>

</body>

{{end}}